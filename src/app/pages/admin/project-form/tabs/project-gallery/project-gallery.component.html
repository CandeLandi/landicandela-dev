<div class="space-y-8">

  @if (images.length > 0) {
    <div class="bg-gray-900/30 backdrop-blur-sm border border-gray-800/50 rounded-2xl overflow-hidden">
      <div class="p-6 border-b border-gray-800/50 flex items-center justify-between">
        <div>
          <h3 class="text-lg font-semibold text-white mb-1">Main Gallery</h3>
          <p class="text-gray-400">Featured image and complete gallery</p>
        </div>
        <div class="shrink-0">
          <input #fileInput type="file" multiple accept="image/*" (change)="onFileSelected($event)" class="hidden" />
          <button type="button" (click)="fileInput.click()" class="px-3 py-2 rounded-lg border border-gray-700 text-gray-300 hover:text-purple-300 hover:border-purple-400 transition-colors flex items-center gap-2 text-sm">
            <i-lucide name="Upload" class="w-4 h-4"></i-lucide>
            Add images
          </button>
        </div>
      </div>

      <div class="p-6">

        <div class="flex flex-col md:flex-row gap-4 items-start">
          <div class="relative flex-1 bg-gray-900/50 rounded-xl overflow-hidden" style="aspect-ratio: 4 / 3; max-height: 560px;" (dragover)="onDragOver($event)" (drop)="onDrop($event)">
            <img
              [src]="getImageUrl(images[currentImageIndex()]) || '/assets/placeholder.svg'"
              [alt]="`Image ${currentImageIndex() + 1}`"
              class="w-full h-full object-contain bg-black"
            />

            @if (images.length > 1) {
              <button
                (click)="previousImage()"
                class="absolute left-4 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors"
              >
                <i-lucide name="ArrowLeft" class="w-5 h-5"></i-lucide>
              </button>
              <button
                (click)="nextImage()"
                class="absolute right-4 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white rounded-full p-3 transition-colors"
              >
                <i-lucide name="ArrowRight" class="w-5 h-5"></i-lucide>
              </button>
            }

            <div class="absolute top-4 right-4 bg-black/70 text-white text-sm px-3 py-1 rounded-full">
              {{ currentImageIndex() + 1 }} / {{ images.length }}
            </div>

            <button
              (click)="removeImage(currentImageIndex())"
              class="absolute top-4 left-4 bg-red-500/80 hover:bg-red-500 text-white rounded-full p-2 transition-colors"
            >
              <i-lucide name="Trash2" class="w-4 h-4"></i-lucide>
            </button>
          </div>

          <div class="w-full md:w-28 lg:w-32 xl:w-36 md:h-[560px] md:overflow-y-auto overflow-x-hidden thumbs-scroll pr-1">
            <div class="grid grid-cols-6 sm:grid-cols-8 md:grid-cols-1 gap-2" cdkDropList (cdkDropListDropped)="onCdkDrop($event)">
              @for (image of images; track $index) {
                <button
                  cdkDrag
                  (click)="setCurrentImage($index)"
                  class="rounded-lg overflow-hidden border-2 transition-all"
                  [class]="$index === currentImageIndex()
                    ? 'border-purple-400 opacity-100 scale-105'
                    : 'border-gray-700 opacity-60 hover:opacity-80'"
                  style="aspect-ratio: 4 / 3;"
                >
                  <img
                    [src]="getImageUrl(image) || '/assets/placeholder.svg'"
                    [alt]="`Thumbnail ${$index + 1}`"
                    class="block w-full h-full object-cover"
                  />
                </button>
              }
            </div>
          </div>
        </div>
      </div>
    </div>
  }

  @else {
    <div class="bg-gray-900/30 backdrop-blur-sm border border-gray-800/50 rounded-2xl p-6">
      <h3 class="text-lg font-semibold text-white mb-4">Upload New Images</h3>

      <input
        type="file"
        multiple
        accept="image/*"
        (change)="onFileSelected($event)"
        class="hidden"
        id="image-upload"
        [disabled]="uploading()"
      />

      <label
        for="image-upload"
        class="group cursor-pointer block w-full border-2 border-dashed border-gray-700 hover:border-purple-400/50 rounded-xl p-12 text-center transition-all duration-300"
        (dragover)="onDragOver($event)"
        (drop)="onDrop($event)"
      >
        <div class="flex flex-col items-center gap-4">
          <div class="p-6 bg-gray-800/50 group-hover:bg-purple-600/20 rounded-full transition-colors">
            @if (uploading()) {
              <i-lucide name="RefreshCw" class="w-10 h-10 text-purple-400 animate-spin"></i-lucide>
            } @else {
              <i-lucide name="Upload" class="w-10 h-10 text-gray-400 group-hover:text-purple-400"></i-lucide>
            }
          </div>
          <div>
            <p class="text-xl text-gray-300 group-hover:text-white transition-colors">
              @if (uploading()) {
                Uploading images...
              } @else {
                Drag images here or click to select
              }
            </p>
            <p class="text-sm text-gray-500 mt-2">PNG, JPG, WEBP up to 5MB each</p>
          </div>
        </div>
      </label>
    </div>
  }
</div>
